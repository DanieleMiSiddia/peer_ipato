<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Peer-ipato - Crea Nuova Conferenza</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* --- 1. VARIABILI E RESET --- */
        :root {
            --primary-blue: #3b5d82;
            --primary-hover: #2d4663;
            --accent-gold: #C59343;
            --bg-page: #ffffff;
            --bg-main: #f4f6f9;
            --text-dark: #1f2937;
            --text-gray: #6b7280;
            --border-color: #e5e7eb;
            --error-red: #ef4444;
            --success-green: #10b981;
            --radius: 12px;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg-page); color: var(--text-dark); min-height: 100vh; display: flex; flex-direction: column; }

        /* --- 2. HEADER & FOOTER --- */
        header { height: 70px; background: white; border-bottom: 1px solid var(--border-color); display: flex; align-items: center; padding: 0 40px; position: fixed; top: 0; width: 100%; z-index: 1000; box-shadow: 0 2px 4px rgba(0,0,0,0.02); }
        .logo-img { height: 36px; margin-right: 12px; }
        .brand-name { font-size: 1.25rem; font-weight: 700; color: #1e3a5f; }
        .brand-name span { color: var(--accent-gold); }
        
        footer { height: 30px; background-color: #f4f6f9; border-top: 1px solid var(--border-color); margin-top: auto; }

        /* --- 3. MAIN --- */
        main { flex: 1; margin-top: 70px; background-color: var(--bg-main); padding: 60px 20px; display: flex; justify-content: center; }
        .container { width: 100%; max-width: 950px; }

        .title-section { margin-bottom: 32px; }
        .title-section h1 { font-size: 2rem; font-weight: 700; margin-bottom: 8px; }
        .title-section p { color: var(--text-gray); }

        .card { background: white; border-radius: var(--radius); padding: 32px; box-shadow: var(--shadow); margin-bottom: 24px; border: 1px solid var(--border-color); }
        .section-header { display: flex; align-items: center; gap: 12px; margin-bottom: 24px; font-weight: 700; color: #1e3a5f; }
        .section-header svg { color: var(--primary-blue); width: 20px; }

        /* Form Layout */
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
        .form-group { display: flex; flex-direction: column; gap: 8px; position: relative; }
        label { font-size: 0.85rem; font-weight: 600; color: var(--text-dark); }
        input { padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 0.95rem; outline: none; }
        input:focus { border-color: var(--primary-blue); box-shadow: 0 0 0 3px rgba(59, 93, 130, 0.1); }
        .error-input { border-color: var(--error-red); }

        /* Topic Badges */
        .topics-container { display: flex; flex-wrap: wrap; gap: 8px; padding: 8px; border: 1px solid var(--border-color); border-radius: 8px; min-height: 48px; align-items: center; }
        .badge { background: #fef3c7; color: #92400e; padding: 4px 10px; border-radius: 6px; font-size: 0.85rem; display: flex; align-items: center; gap: 6px; border: 1px solid #fde68a; }
        .badge span { cursor: pointer; font-weight: bold; }
        .topic-input { border: none; flex: 1; min-width: 120px; padding: 4px; }

        /* Timeline Blocks */
        .timeline-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
        .timeline-block { background: #f8fafc; padding: 20px; border-radius: 10px; border: 1px solid var(--border-color); }
        .timeline-block h4 { font-size: 0.9rem; margin-bottom: 15px; display: flex; align-items: center; gap: 8px; }
        .dot { width: 8px; height: 8px; border-radius: 50%; }

        /* Custom Calendar UI */
        .calendar-popup { position: absolute; top: 100%; left: 0; background: white; border: 1px solid var(--border-color); box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); border-radius: 8px; z-index: 2000; padding: 15px; width: 280px; display: none; margin-top: 5px; }
        .cal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; font-weight: 700; font-size: 0.9rem; }
        .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px; text-align: center; }
        .cal-day { padding: 8px; font-size: 0.8rem; cursor: pointer; border-radius: 4px; }
        .cal-day:hover { background: var(--bg-main); }
        .cal-day.selected { background: var(--accent-gold); color: white; }
        .cal-nav { cursor: pointer; padding: 4px; border-radius: 4px; }
        .cal-nav:hover { background: var(--bg-main); }

        /* Validazioni Errori */
        #error-alert { display: none; background: #fef2f2; border: 1px solid #fecaca; color: var(--error-red); padding: 15px; border-radius: 8px; margin-bottom: 24px; font-size: 0.9rem; align-items: center; gap: 10px; }

        /* Azioni */
        .actions { display: flex; justify-content: flex-end; gap: 15px; margin-top: 20px; }
        .btn { padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600; border: none; display: flex; align-items: center; gap: 8px; }
        .btn-annulla { background: white; border: 1px solid var(--border-color); color: var(--text-dark); }
        .btn-crea { background: var(--primary-blue); color: white; }
        .btn-crea:hover { background: var(--primary-hover); }

        /* Success Badge Overlay */
        #success-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 3000; backdrop-filter: blur(4px); }
        .success-card { background: white; padding: 40px; border-radius: 16px; text-align: center; max-width: 450px; width: 90%; animation: popIn 0.3s ease-out; }
        .success-icon { width: 64px; height: 64px; background: var(--success-green); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px; font-size: 32px; }
        .success-card h2 { margin-bottom: 10px; color: #1e3a5f; }
        .success-card p { color: var(--text-gray); margin-bottom: 24px; font-size: 0.95rem; }
        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        @media (max-width: 768px) { .form-grid, .timeline-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<header>
    <img src="Logo.jpeg" alt="Logo" class="logo-img">
    <div class="brand-name">Peer-<span>ipato</span></div>
</header>

<main>
    <div class="container">
        <div class="title-section">
            <h1>Crea Nuova Conferenza</h1>
            <p>Compila il modulo sottostante per configurare i dettagli, definire i topic e stabilire la cronologia della nuova conferenza.</p>
        </div>

        <div id="error-alert">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>
            <span id="error-msg">Attenzione: Incoerenza nelle date scelte</span>
        </div>

        <div class="card">
            <div class="section-header">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4M12 8h.01"></path></svg>
                Informazioni Generali
            </div>
            <div class="form-grid">
                <div class="form-group">
                    <label>Nome Conferenza</label>
                    <input type="text" id="conf-name" placeholder="Es. International Conference on AI 2024">
                </div>
                <div class="form-group">
                    <label>Email Editore</label>
                    <input type="email" id="editore-email" placeholder="editore@email.com">
                </div>
            </div>
        </div>

        <div class="card">
            <div class="section-header">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 16V8a2 2 0 00-1-1.73l-7-4a2 2 0 00-2 0l-7 4A2 2 0 003 8v8a2 2 0 001 1.73l7 4a2 2 0 002 0l7-4A2 2 0 0021 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg>
                Topic e Metriche
            </div>
            <div class="form-grid">
                <div class="form-group">
                    <label>Topic Conferenza</label>
                    <div class="topics-container" id="topics-box">
                        <input type="text" id="topic-input" class="topic-input" placeholder="Aggiungi Topic...">
                    </div>
                </div>
                <div class="form-group">
                    <label>Numero Articoli Stimati</label>
                    <input type="text" id="articoli-stima" placeholder="Es. 100">
                </div>
            </div>
        </div>

        <div class="card">
            <div class="section-header">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
                Cronologia Sottomissione
            </div>
            <div class="timeline-grid">
                <div class="timeline-block">
                    <h4><div class="dot" style="background:#3b82f6"></div> Fase Sottomissione</h4>
                    <div class="form-group"><label>DATA INIZIO</label><input type="text" readonly class="date-trigger" id="sott-inizio" placeholder="dd/mm/aaaa"></div>
                    <div class="form-group" style="margin-top:10px"><label>DATA FINE</label><input type="text" readonly class="date-trigger" id="sott-fine" placeholder="dd/mm/aaaa"></div>
                </div>
                <div class="timeline-block">
                    <h4><div class="dot" style="background:#a855f7"></div> Fase Revisione</h4>
                    <div class="form-group"><label>DATA INIZIO</label><input type="text" readonly class="date-trigger" id="rev-inizio" placeholder="dd/mm/aaaa"></div>
                    <div class="form-group" style="margin-top:10px"><label>DATA FINE</label><input type="text" readonly class="date-trigger" id="rev-fine" placeholder="dd/mm/aaaa"></div>
                </div>
                <div class="timeline-block">
                    <h4><div class="dot" style="background:#10b981"></div> Giorni Conferenza</h4>
                    <div class="form-group"><label>DATA INIZIO</label><input type="text" readonly class="date-trigger" id="conf-inizio" placeholder="dd/mm/aaaa"></div>
                    <div class="form-group" style="margin-top:10px"><label>DATA FINE</label><input type="text" readonly class="date-trigger" id="conf-fine" placeholder="dd/mm/aaaa"></div>
                </div>
            </div>
        </div>

        <div class="actions">
            <button class="btn btn-annulla">Annulla</button>
            <button class="btn btn-crea" id="submit-crea">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                Crea Conferenza
            </button>
        </div>
    </div>
</main>

<footer></footer>

<div id="calendar-popup" class="calendar-popup">
    <div class="cal-header">
        <span class="cal-nav" id="cal-prev">❮</span>
        <span id="cal-month-year">Mese 2024</span>
        <span class="cal-nav" id="cal-next">❯</span>
    </div>
    <div class="cal-grid" id="cal-days-header">
        <div class="cal-day" style="font-weight:700">L</div><div class="cal-day" style="font-weight:700">M</div>
        <div class="cal-day" style="font-weight:700">M</div><div class="cal-day" style="font-weight:700">G</div>
        <div class="cal-day" style="font-weight:700">V</div><div class="cal-day" style="font-weight:700">S</div>
        <div class="cal-day" style="font-weight:700">D</div>
    </div>
    <div class="cal-grid" id="cal-days-body"></div>
</div>

<div id="success-overlay">
    <div class="success-card">
        <div class="success-icon">✓</div>
        <h2>Conferenza Creata con Successo</h2>
        <p id="success-details"></p>
        <button class="btn btn-crea" style="margin: 0 auto; width: 100%; justify-content: center;" onclick="location.reload()">Chiudi</button>
    </div>
</div>

<script>
    // --- STATE & CONFIG ---
    let selectedTopics = ["Artificial Intelligence", "Machine Learnings"];
    let currentInputId = null;
    let calendarDate = new Date();
    const months = ["Gennaio", "Febbraio", "Marzo", "Aprile", "Maggio", "Giugno", "Luglio", "Agosto", "Settembre", "Ottobre", "Novembre", "Dicembre"];

    // --- INITIALIZATION ---
    document.addEventListener('DOMContentLoaded', () => {
        renderTopics();
        setupCalendar();
        setupValidation();
    });

    // --- TOPICS LOGIC ---
    function renderTopics() {
        const box = document.getElementById('topics-box');
        const input = document.getElementById('topic-input');
        box.querySelectorAll('.badge').forEach(b => b.remove());
        selectedTopics.forEach(t => {
            const b = document.createElement('div');
            b.className = 'badge';
            b.innerHTML = `${t} <span onclick="removeTopic('${t}')">×</span>`;
            box.insertBefore(b, input);
        });
    }

    document.getElementById('topic-input').addEventListener('keypress', (e) => {
        if (e.key === 'Enter' && e.target.value.trim()) {
            selectedTopics.push(e.target.value.trim());
            e.target.value = '';
            renderTopics();
        }
    });

    window.removeTopic = (t) => {
        selectedTopics = selectedTopics.filter(item => item !== t);
        renderTopics();
    };

    // --- VALIDATION LOGIC ---
    function setupValidation() {
        const emailInput = document.getElementById('editore-email');
        const numInput = document.getElementById('articoli-stima');

        emailInput.addEventListener('blur', () => {
            const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            emailInput.classList.toggle('error-input', !regex.test(emailInput.value));
        });

        numInput.addEventListener('input', (e) => {
            e.target.value = e.target.value.replace(/[^0-9]/g, '');
        });

        document.getElementById('submit-crea').addEventListener('click', validateAndSubmit);
    }

    function parseDate(str) {
        if (!str) return null;
        const [d, m, y] = str.split('/').map(Number);
        return new Date(y, m - 1, d);
    }

    function validateDates() {
        const s_start = parseDate(document.getElementById('sott-inizio').value);
        const s_end = parseDate(document.getElementById('sott-fine').value);
        const r_start = parseDate(document.getElementById('rev-inizio').value);
        const r_end = parseDate(document.getElementById('rev-fine').value);
        const c_start = parseDate(document.getElementById('conf-inizio').value);
        const c_end = parseDate(document.getElementById('conf-fine').value);

        const alert = document.getElementById('error-alert');
        const msg = document.getElementById('error-msg');
        
        if (s_start && s_end && s_end < s_start) return showErr("La data di fine sottomissione non può essere precedente all'inizio.");
        if (s_end && r_start && r_start < s_end) return showErr("La data di inizio revisione non può essere precedente alla fine sottomissione.");
        if (r_start && r_end && r_end < r_start) return showErr("La data di fine revisione non può essere precedente all'inizio.");
        if (r_end && c_start && c_start < r_end) return showErr("La conferenza non può iniziare prima del termine della revisione.");
        if (c_start && c_end && c_end < c_start) return showErr("La data di fine conferenza non può essere precedente all'inizio.");

        alert.style.display = 'none';
        return true;
    }

    function showErr(t) {
        const alert = document.getElementById('error-alert');
        document.getElementById('error-msg').innerText = t;
        alert.style.display = 'flex';
        return false;
    }

    // --- CALENDAR LOGIC ---
    function setupCalendar() {
        const popup = document.getElementById('calendar-popup');
        document.querySelectorAll('.date-trigger').forEach(input => {
            input.addEventListener('click', (e) => {
                currentInputId = e.target.id;
                const rect = e.target.getBoundingClientRect();
                popup.style.top = (rect.bottom + window.scrollY) + 'px';
                popup.style.left = rect.left + 'px';
                popup.style.display = 'block';
                renderCalendar();
            });
        });

        document.getElementById('cal-prev').onclick = () => { calendarDate.setMonth(calendarDate.getMonth() - 1); renderCalendar(); };
        document.getElementById('cal-next').onclick = () => { calendarDate.setMonth(calendarDate.getMonth() + 1); renderCalendar(); };

        document.addEventListener('click', (e) => {
            if (!e.target.closest('.date-trigger') && !e.target.closest('#calendar-popup')) {
                popup.style.display = 'none';
            }
        });
    }

    function renderCalendar() {
        const body = document.getElementById('cal-days-body');
        const head = document.getElementById('cal-month-year');
        body.innerHTML = '';
        head.innerText = `${months[calendarDate.getMonth()]} ${calendarDate.getFullYear()}`;

        const firstDay = new Date(calendarDate.getFullYear(), calendarDate.getMonth(), 1).getDay();
        const daysInMonth = new Date(calendarDate.getFullYear(), calendarDate.getMonth() + 1, 0).getDate();
        
        // Adjust for Monday start
        let startShift = firstDay === 0 ? 6 : firstDay - 1;

        for (let i = 0; i < startShift; i++) {
            body.appendChild(document.createElement('div'));
        }

        for (let d = 1; d <= daysInMonth; d++) {
            const el = document.createElement('div');
            el.className = 'cal-day';
            el.innerText = d;
            el.onclick = () => {
                const formatted = `${d.toString().padStart(2, '0')}/${(calendarDate.getMonth()+1).toString().padStart(2, '0')}/${calendarDate.getFullYear()}`;
                document.getElementById(currentInputId).value = formatted;
                document.getElementById('calendar-popup').style.display = 'none';
                validateDates();
            };
            body.appendChild(el);
        }
    }

    // --- FINAL SUBMISSION ---
    function validateAndSubmit() {
        const name = document.getElementById('conf-name').value;
        const email = document.getElementById('editore-email').value;
        const stima = document.getElementById('articoli-stima').value;
        const dateInputVal = document.getElementById('conf-inizio').value;

        if (!name || !email || !stima || selectedTopics.length === 0 || !dateInputVal) {
            return showErr("Per favore, compila tutti i campi obbligatori.");
        }

        if (!validateDates()) return;

        // Success
        document.getElementById('success-details').innerHTML = `<strong>${name}</strong><br>Inizio conferenza: ${dateInputVal}<br><br>La conferenza è stata configurata correttamente.`;
        document.getElementById('success-overlay').style.display = 'flex';
    }
</script>

</body>
</html>