<ion-content [fullscreen]="true">
    <div class="page-wrapper">

        <header class="app-header">
            <div class="header-brand">
                <img src="assets/Logo.jpeg" alt="Peer-ipato Logo" class="logo-img">
                <div class="brand-name">Peer-<span>ipato</span></div>
            </div>
        </header>

        <main class="main-content">
            <div class="container">
                <div class="submission-card">

                    <div class="page-header">
                        <h1>Sottomissione Articolo</h1>
                        <p>Compila il form sottostante per inviare il tuo contributo alla conferenza. Assicurati di rispettare le linee guida per gli autori.</p>
                    </div>

                    @if (submitError) {
                        <div class="error-alert">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
                            <span>{{ submitError }}</span>
                        </div>
                    }

                    <!-- Campi testuali -->
                    <div class="fields-section">
                        <div class="field-group">
                            <label for="titolo">Titolo dell'articolo *</label>
                            <input type="text" id="titolo" class="field-input"
                                   placeholder="Inserisci il titolo del tuo articolo"
                                   maxlength="255" [(ngModel)]="titolo" [disabled]="loading"
                                   autocomplete="off">
                        </div>
                        <div class="field-group">
                            <label for="topic">Topic *</label>
                            <input type="text" id="topic" class="field-input"
                                   placeholder="Es. Machine Learning, Distributed Systems, ..."
                                   maxlength="255" [(ngModel)]="topic" [disabled]="loading"
                                   autocomplete="off">
                        </div>
                    </div>

                    <!-- Upload documento -->
                    <div class="upload-section">
                        <h2 class="section-title">Documento dell'articolo *</h2>
                        <p class="section-subtext">Carica il file del tuo articolo (solo PDF, max 16MB)</p>

                        <div class="upload-area" [class.drag-over]="isDragOver"
                             (click)="openFilePicker()"
                             (dragover)="onDragOver($event)"
                             (dragleave)="onDragLeave()"
                             (drop)="onDrop($event)">
                            <svg class="upload-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                            </svg>
                            <p class="upload-text">Clicca per caricare o trascina il file qui</p>
                            <button class="btn-attach" type="button" (click)="$event.stopPropagation(); openFilePicker()">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"/>
                                </svg>
                                Allega Documento
                            </button>
                            <input type="file" accept=".pdf" #fileInput style="display:none"
                                   (change)="onFileSelected($event)">
                        </div>

                        @if (fileError) {
                            <p class="error-msg">Formato non valido o file troppo grande (solo PDF, max 16MB).</p>
                        }

                        @if (selectedFile) {
                            <div class="file-list">
                                <div class="file-item">
                                    <svg class="file-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                    </svg>
                                    <div class="file-info">
                                        <p class="file-name">{{ selectedFile.name }}</p>
                                        <p class="file-details">{{ fileSizeMB() }} MB &bull; <span>Pronto per l'invio</span></p>
                                    </div>
                                    <button class="btn-delete" type="button" (click)="removeFile()">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        }
                    </div>

                    <!-- Pulsanti -->
                    <div class="actions-row">
                        <button class="btn-action btn-cancel" type="button" (click)="annulla()" [disabled]="loading">
                            Annulla
                        </button>
                        <button class="btn-action btn-confirm" type="button"
                                [class.active]="confirmEnabled && !loading"
                                (click)="submit()">
                            {{ loading ? 'Invio in corso...' : 'Conferma' }}
                            @if (!loading) {
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                                    <line x1="5" y1="12" x2="19" y2="12"/>
                                    <polyline points="12 5 19 12 12 19"/>
                                </svg>
                            }
                        </button>
                    </div>

                </div>
            </div>
        </main>

        <!-- Success overlay -->
        @if (showSuccess) {
            <div class="success-overlay">
                <div class="success-card">
                    <div class="success-icon">✓</div>
                    <h2>Articolo Sottomesso con Successo</h2>
                    <p>Il tuo articolo è stato inviato correttamente alla conferenza.</p>
                    <button class="btn-confirm-overlay" (click)="annulla()">Torna alla Dashboard</button>
                </div>
            </div>
        }

    </div>
</ion-content>
